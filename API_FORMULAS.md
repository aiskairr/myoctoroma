# API Формулы расчета

## /api/statistics/accounting/{startDate}/{endDate}?branchId={id}

Этот эндпоинт возвращает все необходимые данные в едином формате:

### Формат ответа:
```json
{
    "success": true,
    "data": [доходы, расходы, записей, прибыль],
    "period": {
        "startDate": "2025-10-02",
        "endDate": "2025-10-02"
    },
    "branchId": "1"
}
```

### Данные в массиве data:
- `data[0]` - **Доходы за день** (dailyIncome)
- `data[1]` - **Расходы за день** (dailyExpenses) 
- `data[2]` - **Записей за день** (recordsCount)
- `data[3]` - **Чистая прибыль** (netProfit)

### Формулы расчета:

#### data[0] - Доходы за день
```
dailyIncome = сумма всех daily_report 
```
**НЕ учитывает операции с gift-certificates** (в отличие от "Общей выручки")

#### data[1] - Расходы за день  
```
dailyExpenses = сумма всех expenses.amount за день
```
Мелкие расходы

#### data[2] - Записей за день
```
recordsCount = количество записей в accounting за день
```

#### data[3] - Чистая прибыль
```
netProfit = dailyIncome - dailyExpenses
```

### Для сравнения: Общая выручка (из DailyCashReport.tsx)
```
totalRevenue = сумма_всех_daily_report - использованные_сертификаты + созданные_сертификаты
```

## Различие между показателями:

| Показатель | Формула | Учет сертификатов |
|------------|---------|------------------|
| **Доходы за день** | `sum(daily_report)` | ❌ НЕТ |
| **Общая выручка** | `sum(daily_report) - использованные + созданные` | ✅ ДА |
| **Расходы за день** | `sum(expenses.amount)` | ❌ НЕТ |
| **Чистая прибыль** | `доходы - расходы` | ❌ НЕТ |

## Использование в компонентах:

### Dashboard.tsx
- Использует единый эндпоинт `/api/statistics/accounting`
- Обрабатывает массив данных `[доходы, расходы, записей, прибыль]`
- Отображает все 4 карточки статистики

### AccountingPage.tsx  
- Использует тот же эндпоинт `/api/statistics/accounting`
- Получает те же данные для отображения статистики
- Синхронизированы с Dashboard

## ⚠️ Удаленные эндпоинты:
- `/api/daily-cash-reports` - больше не используется
- Все данные теперь приходят через `/api/statistics/accounting`
