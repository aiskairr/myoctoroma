# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 401 –æ—à–∏–±–∫–∏ –ø—Ä–∏ Hot Reload

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ –∏ hot reload (–≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ):
- ‚úÖ –ü–µ—Ä–≤—ã–π —Ä–∞–∑ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –≤ IDE ‚Üí 401 Unauthorized
- ‚ùå –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∑–∞–Ω–æ–≤–æ –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è

---

## –ü—Ä–∏—á–∏–Ω–∞

–í BranchContext –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **–ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ axios** –≤–º–µ—Å—Ç–æ **$apiSecondary** —Å interceptors:

```typescript
// ‚ùå –ë–´–õ–û (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º refresh)
const response = await axios.get(url, {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

–ü—Ä–∏ hot reload:
1. Access token –∏—Å—Ç–µ–∫–∞–µ—Ç (–∂–∏–≤—ë—Ç 15-30 –º–∏–Ω—É—Ç)
2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –∏—Å—Ç—ë–∫—à–∏–º —Ç–æ–∫–µ–Ω–æ–º
3. –ü–æ–ª—É—á–∞–µ—Ç 401 –æ—à–∏–±–∫—É
4. **–ù–ï** –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è refresh token (—Ç.–∫. –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä—è–º–æ–π axios)
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ—à–∏–±–∫—É

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ–º **$apiSecondary** –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç interceptor –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:

```typescript
// ‚úÖ –°–¢–ê–õ–û (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º refresh)
const response = await $apiSecondary.get('/organizations?ownerId=${user?.id}');
```

–ü—Ä–∏ 401 –æ—à–∏–±–∫–µ interceptor:
1. –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
2. –í—ã–∑—ã–≤–∞–µ—Ç `/user/refresh` —Å refresh token
3. –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π access token
4. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–º–µ—á–∞–µ—Ç ‚ú®

---

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **BranchContext.tsx** - –∑–∞–≥—Ä—É–∑–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–ë—ã–ª–æ:**
```typescript
import axios from "axios";

const token = localStorage.getItem('auth_token');
const response = await axios.get(url, {
  headers: { 'Authorization': `Bearer ${token}` }
});
```

**–°—Ç–∞–ª–æ:**
```typescript
import { $apiSecondary } from "@/API/http";

const response = await $apiSecondary.get(`/organizations?ownerId=${user?.id}`);
```

**–§–∞–π–ª:** `src/contexts/BranchContext.tsx:71-72`

---

### 2. **BranchContext.tsx** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª–∏–∞–ª–æ–≤

**–ë—ã–ª–æ:**
```typescript
const token = localStorage.getItem('auth_token');
const branchesResponse = await fetch(branchesUrl, {
  headers: {
    'Authorization': token ? `Bearer ${token}` : '',
  }
});
```

**–°—Ç–∞–ª–æ:**
```typescript
const branchesResponse = await $apiSecondary.get<Branch[]>(
  `/branches?organizationId=${orgData}`
);
```

**–§–∞–π–ª:** `src/contexts/BranchContext.tsx:117-119`

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º refresh:

```
1. Hot Reload –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
   ‚Üì
2. BranchContext –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
   ‚Üì
3. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è logCheck() ‚Üí GET /organizations
   ‚Üì
4. Access token –∏—Å—Ç—ë–∫ ‚Üí 401 Unauthorized
   ‚Üì
5. Interceptor –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç 401
   ‚Üì
6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è POST /user/refresh
   ‚Üì
7. –ü–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π access token
   ‚Üì
8. –ó–∞–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
   ‚Üì
9. ‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
```

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

–ü—Ä–∏ hot reload –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
üè¢ logCheck STARTED
üîÑ Attempting to refresh access token...
‚úÖ Access token refreshed successfully
‚úÖ Organization loaded: {name}
```

### 2. –í Network tab:

–ü—Ä–∏ 401 –æ—à–∏–±–∫–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å `/organizations` ‚Üí 401
2. –ó–∞–ø—Ä–æ—Å `/user/refresh` ‚Üí 200 (–ø–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω)
3. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å `/organizations` ‚Üí 200 (—Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º)

### 3. –¢–µ—Å—Ç:

1. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –≤ —Å–∏—Å—Ç–µ–º—É
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã (–∏–ª–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è access token)
3. –ò–∑–º–µ–Ω–∏—Ç–µ –ª—é–±–æ–π —Ñ–∞–π–ª –≤ –∫–æ–¥–µ
4. Hot reload –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç
5. ‚úÖ –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –î—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—â—ë –º–Ω–æ–≥–æ –º–µ—Å—Ç –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–ø—Ä—è–º–æ–π fetch** –≤–º–µ—Å—Ç–æ **$api** –∏–ª–∏ **$apiSecondary**.

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –ø—Ä—è–º—ã–º fetch:

- `src/components/EditAppointmentDialog.tsx`
- `src/components/calendar/AppointmentDialog.tsx`
- `src/components/DailyCashReport.tsx`
- `src/pages/Calendar/components/time-schedule.tsx`
- –ò –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ...

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–º–µ–Ω—è–π—Ç–µ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã:

```typescript
// ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ
await fetch(url, {
  headers: { 'Authorization': `Bearer ${token}` }
});

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ
import { $api } from '@/API/http';  // –¥–ª—è PRIMARY_BACKEND
import { $apiSecondary } from '@/API/http';  // –¥–ª—è SECONDARY_BACKEND

await $api.get('/endpoint');
await $apiSecondary.post('/endpoint', data);
```

---

## üìã –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è $api/$apiSecondary

1. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 401
2. ‚úÖ **–û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤** - –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö 401 —Ç–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
3. ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –≤—Å–µ –æ—à–∏–±–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
4. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–ª—è—Ç—å –≤ headers
5. ‚úÖ **–¢–∏–ø–∏–∑–∞—Ü–∏—è** - TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑ –∫–æ—Ä–æ–±–∫–∏

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ BranchContext –∏—Å–ø—Ä–∞–≤–ª–µ–Ω - —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å hot reload
2. üîÑ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–º–µ–Ω—è–π—Ç–µ –ø—Ä—è–º—ã–µ fetch –Ω–∞ $api/$apiSecondary
3. üîÑ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. üîÑ –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ endpoint `/user/refresh` —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

---

## üêõ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤—Å—ë –µ—â—ë –µ—Å—Ç—å

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å:

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
```
üîÑ Attempting to refresh access token...
‚úÖ Access token refreshed successfully
```

–ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ï—Å—Ç—å –ª–∏ `refresh_token` –≤ localStorage
- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ endpoint `/user/refresh`

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab:

- –ó–∞–ø—Ä–æ—Å `/user/refresh` –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 200 –∏ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
- –ï—Å–ª–∏ 401 - refresh token —Ç–æ–∂–µ –∏—Å—Ç—ë–∫, –Ω—É–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ localStorage:

```javascript
localStorage.getItem('refresh_token')  // –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ null
```

–ï—Å–ª–∏ null - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω, –Ω—É–∂–µ–Ω –ª–æ–≥–∏–Ω.

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [TOKEN_AUTHENTICATION.md](./TOKEN_AUTHENTICATION.md) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–∏—Å—Ç–µ–º–µ —Ç–æ–∫–µ–Ω–æ–≤
- [CONSOLE_LOGS_OPTIMIZATION.md](./CONSOLE_LOGS_OPTIMIZATION.md) - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤
- [CALENDAR_ENDPOINTS.md](./CALENDAR_ENDPOINTS.md) - API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∫–∞–ª–µ–Ω–¥–∞—Ä—è
