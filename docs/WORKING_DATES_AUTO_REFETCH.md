# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è

## –ü—Ä–æ–±–ª–µ–º–∞
–†–∞–±–æ—á–∏–µ –¥–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–ª–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã–µ "—Å–ª–µ—Ç–∞–ª–∏" –∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è.

## –ü—Ä–∏—á–∏–Ω–∞
- `useQuery` –∑–∞–≥—Ä—É–∂–∞–ª –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ü–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –¥–Ω–µ–π) –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å —Å —Å–µ—Ä–≤–µ—Ä–∞
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–ª–∞–≥–∞–ª—Å—è –Ω–∞ –ø—Ä–æ–ø—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏

## –†–µ—à–µ–Ω–∏–µ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
```typescript
const { data: serverWorkingDates, isLoading: isLoadingServerDates, refetch: refetchWorkingDates } = useQuery<ServerWorkingDate[]>({
  queryKey: ['working-dates', masterId],
  queryFn: async () => {
    if (!masterId) return [];
    console.log('üîÑ Fetching working dates for master:', masterId);
    const response = await fetch(`${import.meta.env.VITE_BACKEND_URL}/api/masters/${masterId}/working-dates`);
    if (!response.ok) {
      throw new Error('Failed to fetch working dates');
    }
    const data = await response.json();
    console.log('‚úÖ Fetched working dates:', data);
    return data;
  },
  enabled: !!masterId,
  refetchOnMount: 'always', // ‚úÖ –ö–õ–Æ–ß–ï–í–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê: –≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  refetchOnWindowFocus: false, // –ù–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ (–∏–∑–±–µ–≥–∞–µ–º –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
  staleTime: 0, // –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏
});
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `refetchOnMount: 'always'` - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- `staleTime: 0` - –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏, —á—Ç–æ —Ñ–æ—Ä—Å–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É
- `refetchOnWindowFocus: false` - –∏–∑–±–µ–≥–∞–µ–º –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É –æ–∫–Ω–∞–º–∏

### 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
```typescript
// CRITICAL: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
useEffect(() => {
  if (masterId) {
    console.log('üöÄ Component mounted, fetching working dates for master:', masterId);
    refetchWorkingDates();
  }
}, [masterId, refetchWorkingDates]);
```

–≠—Ç–æ—Ç `useEffect` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–∂–µ –µ—Å–ª–∏ `refetchOnMount` –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —è–≤–Ω–æ —á–µ—Ä–µ–∑ `refetch()`.

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–π

#### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è:
```typescript
const createWorkingDateMutation = useMutation({
  mutationFn: async (data) => { /* ... */ },
  onSuccess: () => {
    console.log('‚úÖ Working date created, refetching from server...');
    refetchWorkingDates(); // ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
  },
  onError: (error: Error) => {
    console.error('Failed to save working date:', error);
  }
});
```

#### –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è:
```typescript
const deleteWorkingDateMutation = useMutation({
  mutationFn: async (data) => { /* ... */ },
  onSuccess: () => {
    toast({
      title: "–†–∞–±–æ—á–∏–π –¥–µ–Ω—å —É–¥–∞–ª–µ–Ω",
      description: "–†–∞–±–æ—á–∏–π –¥–µ–Ω—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω",
      variant: "default",
    });

    console.log('‚úÖ Working date deleted, refetching from server...');
    refetchWorkingDates(); // ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
  },
  onError: (error: Error) => { /* ... */ }
});
```

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º
```typescript
// –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
useEffect(() => {
  if (serverWorkingDates && masterId) {
    console.log('üì• Raw server data received:', serverWorkingDates);
    
    const convertedDates = convertServerToLocalFormat(serverWorkingDates);
    
    console.log('‚úÖ Server data converted:', {
      rawCount: serverWorkingDates.length,
      convertedCount: convertedDates.length,
      dates: convertedDates.map(d => d.date)
    });
    
    onWorkingDatesChange(convertedDates); // –û–±–Ω–æ–≤–ª—è–µ–º parent component
    forceRefreshCalendar(); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    
    console.log('‚úÖ Calendar refreshed with server data');
  }
}, [serverWorkingDates, masterId]);
```

## –ì–∞—Ä–∞–Ω—Ç–∏–∏ —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–∏–∞–ª–æ–≥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞:
1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `refetchWorkingDates()`
3. –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ API `/api/masters/{id}/working-dates`
4. –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ UTC –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
5. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### ‚úÖ –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è:
1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è POST –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –í `onSuccess` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `refetchWorkingDates()`
3. –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞
4. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

### ‚úÖ –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è:
1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è DELETE –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –í `onSuccess` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `refetchWorkingDates()`
3. –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞
4. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

### ‚úÖ –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–∏–∞–ª–æ–≥–∞:
1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ
2. `refetchOnMount: 'always'` —Ñ–æ—Ä—Å–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É
3. `useEffect` –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `refetchWorkingDates()`
4. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π —à–∞–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```
üöÄ Component mounted, fetching working dates for master: 15
üîÑ Fetching working dates for master: 15
‚úÖ Fetched working dates: [...]
üì• Raw server data received: [...]
‚úÖ Server data converted: { rawCount: 5, convertedCount: 5, dates: [...] }
‚úÖ Calendar refreshed with server data
‚úÖ Working date created, refetching from server...
‚úÖ Working date deleted, refetching from server...
```

## –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞
1. –û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞
2. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ –∏–∑ –ë–î

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–Ω—è
1. –û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. –í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–µ–Ω—å —Å—Ä–∞–∑—É –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç—Å—è –∑–µ–ª–µ–Ω—ã–º

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –£–¥–∞–ª–µ–Ω–∏–µ –¥–Ω—è
1. –û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. –£–¥–∞–ª–∏—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ä–∞–∑—É –∏—Å—á–µ–∑–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ó–∞–∫—Ä—ã—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å —Å–Ω–æ–≤–∞
1. –û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥
2. –î–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –¥–Ω–∏
3. –ó–∞–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥
4. –û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ —Å–Ω–æ–≤–∞
5. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –ë–î

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–∏
1. –û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ –º–∞—Å—Ç–µ—Ä–∞ –≤ –¥–≤—É—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
2. –í –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å
3. –í–æ –≤—Ç–æ—Ä–æ–π –≤–∫–ª–∞–¥–∫–µ –∑–∞–∫—Ä—ã—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –≤–æ –≤—Ç–æ—Ä–æ–π –≤–∫–ª–∞–¥–∫–µ

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `/src/components/MasterWorkingDatesManager.tsx` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- `/docs/SERVER_DATES_PARSING_FIX.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø–∞—Ä—Å–∏–Ω–≥—É –¥–∞—Ç
- `/docs/WORKING_DATES_CALENDAR_RELIABLE_SYSTEM.md` - —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

## –î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
3 –Ω–æ—è–±—Ä—è 2025 –≥.
