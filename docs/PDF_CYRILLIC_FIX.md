# Исправление проблемы с кириллицей в PDF отчетах

## Дата: 27 ноября 2025 г.

## ✅ Проблема решена!

### Что было не так:

Библиотека **jsPDF** не поддерживает кириллические символы в стандартных шрифтах:
- Русский текст → крякозябры ❌
- Киргизский текст → крякозябры ❌
- Цифры → отображались нормально ✅

### Как исправлено:

Вместо текстовой генерации PDF через jsPDF + autoTable, теперь используется:

**html2canvas + jsPDF** - рендерим HTML таблицу как изображение и вставляем в PDF.

### Изменения в коде:

#### 1. Обновлены импорты в `ReportPage.tsx`:

```typescript
// Было:
import jsPDF from 'jspdf';
import autoTable from 'jspdf-autotable';

// Стало:
import html2canvas from 'html2canvas';
import jsPDF from 'jspdf';
```

#### 2. Добавлен ID к контейнеру таблицы:

```tsx
<Card id="report-table-container" className="rounded-xl shadow-lg">
  {/* Таблица с отчетами */}
</Card>
```

#### 3. Полностью переписана функция `exportToPDF`:

```typescript
const exportToPDF = async () => {
  // 1. Находим таблицу по ID
  const element = document.getElementById('report-table-container');
  
  // 2. Конвертируем HTML в canvas
  const canvas = await html2canvas(element, {
    scale: 2,              // Высокое качество
    useCORS: true,
    logging: false,
    backgroundColor: '#ffffff',
  });
  
  // 3. Создаем PDF из изображения
  const imgData = canvas.toDataURL('image/png');
  const pdf = new jsPDF('landscape', 'mm', 'a4');
  
  // 4. Добавляем изображение в PDF с поддержкой многостраничности
  pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
  
  // 5. Сохраняем файл
  pdf.save(`отчет_${startDate}_${endDate}.pdf`);
};
```

### Преимущества нового подхода:

✅ **Идеальное отображение кириллицы** - весь текст рендерится как на экране  
✅ **Сохраняются все стили** - цвета, шрифты, выравнивание  
✅ **Простота реализации** - не нужно работать со шрифтами  
✅ **Поддержка многостраничных отчетов** - автоматически добавляет страницы  
✅ **Работает с любыми языками** - русский, киргизский, английский

### Недостатки (незначительные):

⚠️ **Нельзя выделить текст в PDF** - это изображение, а не текст  
⚠️ **Немного больший размер файла** - из-за PNG изображения  

### Как протестировать:

1. Откройте страницу "Отчеты" (ReportPage)
2. Выберите период дат
3. Нажмите кнопку "Экспорт в PDF"
4. Проверьте, что:
   - ✅ Русский текст отображается корректно
   - ✅ Киргизский текст отображается корректно
   - ✅ Цифры отображаются корректно
   - ✅ Таблица сохраняет все стили и цвета
   - ✅ Многостраничные отчеты корректно разбиваются на страницы

### Технические детали:

- **html2canvas** конвертирует DOM элемент в canvas
- **scale: 2** обеспечивает высокое разрешение (подходит для печати)
- Автоматическое добавление страниц при большом количестве данных
- Отступы по 10мм с каждой стороны для корректной печати

---

**Статус:** ✅ Исправлено  
**Файлы изменены:** `src/pages/ReportPage.tsx`  
**Зависимости:** `html2canvas` (уже установлена)  
**Готово к использованию:** Да
