# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: masterId vs user.id

**–î–∞—Ç–∞:** 20 –æ–∫—Ç—è–±—Ä—è 2025 –≥.  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–§–∞–π–ª:** `src/pages/Calendar/MasterCalendarView.tsx`

## –ü—Ä–æ–±–ª–µ–º–∞

### –°–∏–º–ø—Ç–æ–º—ã
API –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–µ–≤–µ—Ä–Ω—ã–π ID:
```
GET /api/crm/tasks-master-calendar?masterId=38&date=2025-10-20
```

–ì–¥–µ `masterId=38` - —ç—Ç–æ `user.id` (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è), –Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `masterId=6` (ID –º–∞—Å—Ç–µ—Ä–∞).

### –ü—Ä–∏—á–∏–Ω–∞

–ö–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª fallback –Ω–∞ `user.id`:
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
const masterId = user.masterId || user.master_id || user.id;
```

–ü—Ä–∏ —ç—Ç–æ–º:
- `user.id = 38` (ID –≤ —Ç–∞–±–ª–∏—Ü–µ `users`)
- `user.masterId = 6` (ID –≤ —Ç–∞–±–ª–∏—Ü–µ `masters`)

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω, –Ω–æ –≤ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ API –Ω–µ –±—ã–ª–æ –ø–æ–ª—è `masterId`, –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `user.id` (38) –≤–º–µ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ ID –º–∞—Å—Ç–µ—Ä–∞ (6).

## –†–µ—à–µ–Ω–∏–µ

### –£–±—Ä–∞–Ω fallback –Ω–∞ user.id

```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
const masterId = user.masterId || user.master_id;
```

–¢–µ–ø–µ—Ä—å:
1. –ï—Å–ª–∏ –µ—Å—Ç—å `user.masterId` (6) ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–Ω–æ ‚úÖ
2. –ï—Å–ª–∏ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å `user.master_id` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è deprecated –ø–æ–ª–µ
3. –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ —Ç–æ–≥–æ, –Ω–∏ –¥—Ä—É–≥–æ–≥–æ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `masterId` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
```
–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–ü–æ–ª–µ masterId –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

User ID: 38
masterId: –Ω–µ –∑–∞–¥–∞–Ω
master_id: –Ω–µ –∑–∞–¥–∞–Ω

–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –∫ –ø—Ä–æ—Ñ–∏–ª—é –º–∞—Å—Ç–µ—Ä–∞
```

## –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π API –∑–∞–ø—Ä–æ—Å

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:
```
GET /api/crm/tasks-master-calendar?masterId=6&date=2025-10-20
```

–ì–¥–µ `masterId=6` - —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `user.masterId`.

## –°–≤—è–∑—å —Ç–∞–±–ª–∏—Ü

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  users          ‚îÇ
‚îÇ  id: 38         ‚îÇ ‚Üê user.id (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
‚îÇ  email: ...     ‚îÇ
‚îÇ  role: master   ‚îÇ
‚îÇ  masterId: 6    ‚îÇ ‚Üê —Å—Å—ã–ª–∫–∞ –Ω–∞ masters.id
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ masterId
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  masters        ‚îÇ
‚îÇ  id: 6          ‚îÇ ‚Üê user.masterId (ID –º–∞—Å—Ç–µ—Ä–∞)
‚îÇ  name: –ê–∑–∞—Ç     ‚îÇ
‚îÇ  ...            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **user.id –∏ user.masterId - —ç—Ç–æ –†–ê–ó–ù–´–ï –∑–Ω–∞—á–µ–Ω–∏—è**
   - –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user.id` –≤–º–µ—Å—Ç–æ `masterId` –≤ API –∑–∞–ø—Ä–æ—Å–∞—Ö
   - Backend –æ–∂–∏–¥–∞–µ—Ç ID –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `masters`, –∞ –Ω–µ `users`

2. **Fallback –Ω–∞ user.id –±—ã–ª –æ—à–∏–±–∫–æ–π**
   - –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ —Ç–æ–ª—å–∫–æ —Å–ª—É—á–∞–π–Ω–æ, –∫–æ–≥–¥–∞ `user.id` —Å–æ–≤–ø–∞–¥–∞–ª —Å `masterId`
   - –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —ç—Ç–∏ ID —Ä–∞–∑–Ω—ã–µ

3. **Backend –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å masterId**
   - –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é `master`
   - –í –æ—Ç–≤–µ—Ç–µ `/api/user` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–µ `masterId`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
// –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
üë§ MasterCalendarView - User info: {
  user: { id: 38, masterId: 6, ... },
  role: 'master',
  masterId: 6,      // ‚Üê –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID –º–∞—Å—Ç–µ—Ä–∞
  master_id: undefined,
  id: 38            // ‚Üê ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å!)
}

üîç Fetching master calendar: {
  masterId: 6,      // ‚Üê –ø—Ä–∞–≤–∏–ª—å–Ω–æ!
  date: '2025-10-20',
  url: '.../api/crm/tasks-master-calendar?masterId=6&date=2025-10-20'
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Network –∑–∞–ø—Ä–æ—Å–∞:

```
Request URL: .../api/crm/tasks-master-calendar?masterId=6&date=2025-10-20
                                                         ‚Üë
                                                    –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 6, –ù–ï 38!
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `MASTER_ID_MIGRATION.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- `USER_REGISTRATION_FIX.md` - –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—Ç–µ—Ä–æ–≤
