# Zapisi.kz Import - Pending Status Fix

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –Ω–∞ `POST /api/import/zapisikz/upload`, backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`:

```json
{
  "jobId": "ZAPISIKZ_1762005548392_dunsbhebg",
  "status": "pending",
  "message": "Import started",
  "fileName": "reservations.xlsx"
}
```

–û–¥–Ω–∞–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–ª —ç—Ç–æ –∫–∞–∫ **–æ—à–∏–±–∫—É** –≤–º–µ—Å—Ç–æ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –∏–º–ø–æ—Ä—Ç–∞.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å `zapisikz-import.service.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `uploadFile()`:**

```typescript
// –ë–´–õ–û:
return await response.json();

// –°–¢–ê–õ–û:
const result = await response.json();

// Backend –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å: { jobId, status, message, fileName }
// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
if (result.jobId && result.status) {
  return {
    success: true,
    data: {
      jobId: result.jobId,
      status: result.status,
      fileName: result.fileName,
    },
  };
}

// –ò–ª–∏ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —É–∂–µ –æ–±—ë—Ä–Ω—É—Ç—ã–π —Ñ–æ—Ä–º–∞—Ç: { success, data }
return result;
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `getJobStatus()`:**

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä—è–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç backend.

### 2. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ZapisikzImportTab.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏:**

```typescript
onSuccess: (response) => {
  if (response.success && response.data) {
    const { jobId, status } = response.data;
    setCurrentJobId(jobId);
    
    // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å pending –∏–ª–∏ processing - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å
    if (status === 'pending' || status === 'processing') {
      toast({
        title: t('zapisikz.upload_started') || '–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å',
        description: t('zapisikz.upload_started_desc') || '–ò–º–ø–æ—Ä—Ç –Ω–∞—á–∞–ª—Å—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.',
      });
    } else {
      toast({
        title: t('zapisikz.upload_success') || '–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω',
        description: t('zapisikz.upload_success_desc') || '–ò–º–ø–æ—Ä—Ç –Ω–∞—á–∞–ª—Å—è',
      });
    }
    setSelectedFile(null);
  }
}
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏

**–†—É—Å—Å–∫–∏–π:**
```typescript
'zapisikz.upload_started': '–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å',
'zapisikz.upload_started_desc': '–ò–º–ø–æ—Ä—Ç –Ω–∞—á–∞–ª—Å—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.',
```

**–ö—ã—Ä–≥—ã–∑—Å–∫–∏–π:**
```typescript
'zapisikz.upload_started': '–ñ“Ø–∫—Ç”©”© –±–∞—à—Ç–∞–ª–¥—ã',
'zapisikz.upload_started_desc': '–ò–º–ø–æ—Ä—Ç –±–∞—à—Ç–∞–ª–¥—ã, –∫“Ø—Ç”© —Ç—É—Ä—É“£—É–∑. –ë—É–ª –±–∏—Ä –∞–∑ —É–±–∞–∫—ã—Ç –∞–ª–∞—Ç.',
```

**–ê–Ω–≥–ª–∏–π—Å–∫–∏–π:**
```typescript
'zapisikz.upload_started': 'Upload started',
'zapisikz.upload_started_desc': 'Import started, please wait. This may take some time.',
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚ùå

- ‚úÖ Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `200 OK` —Å `{ jobId, status: "pending" }`
- ‚ùå –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –∏–º–ø–æ—Ä—Ç –Ω–∞—á–∞–ª—Å—è

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚úÖ

- ‚úÖ Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `200 OK` —Å `{ jobId, status: "pending" }`
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: **"–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å"**
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ: **"–ò–º–ø–æ—Ä—Ç –Ω–∞—á–∞–ª—Å—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ"**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è polling —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å

## üîÑ Workflow –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª**
   - –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"

2. **Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å**
   - –°–æ–∑–¥–∞—ë—Ç job —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º `jobId`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `200 OK` —Å `status: "pending"`

3. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç**
   - ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –∫–∞–∫ —É—Å–ø–µ—Ö (–Ω–µ –æ—à–∏–±–∫—É!)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `jobId`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç toast: **"–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å"**

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π polling**
   - –ö–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `GET /api/import/zapisikz/status/:jobId`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç UI —Å —Ç–µ–∫—É—â–∏–º —Å—Ç–∞—Ç—É—Å–æ–º
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (masters, clients, bookings)

5. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞**
   - –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `completed` –∏–ª–∏ `failed`
   - Polling –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## üìä –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å—Ç–∞—Ç—É—Å—ã

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | UI –ü–æ–≤–µ–¥–µ–Ω–∏–µ |
|--------|----------|--------------|
| `pending` | –í –æ—á–µ—Ä–µ–¥–∏, –æ–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ | ‚è≥ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å", –Ω–∞—á–∏–Ω–∞–µ—Ç polling |
| `processing` | –§–∞–π–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è | ‚öôÔ∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç progress bar, –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç polling |
| `completed` | –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ | ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç polling |
| `failed` | –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ | ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç polling |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
1. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Zapisi.kz (.xlsx)
2. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"
3. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è toast: **"–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å"**
4. ‚úÖ –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫

### –¢–µ—Å—Ç 2: Polling —Å—Ç–∞—Ç—É—Å–∞
1. –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
2. ‚úÖ –ö–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å
3. ‚úÖ –î–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
4. ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ `status: "processing"`

### –¢–µ—Å—Ç 3: –í—Å–µ —è–∑—ã–∫–∏
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ —è–∑—ã–∫ –Ω–∞ –†—É—Å—Å–∫–∏–π
   - ‚úÖ "–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å"
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –Ω–∞ –ö—ã—Ä–≥—ã–∑—Å–∫–∏–π
   - ‚úÖ "–ñ“Ø–∫—Ç”©”© –±–∞—à—Ç–∞–ª–¥—ã"
3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –Ω–∞ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
   - ‚úÖ "Upload started"

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. **src/services/zapisikz-import.service.ts** (2 –∏–∑–º–µ–Ω–µ–Ω–∏—è)
   - `uploadFile()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç backend
   - `getJobStatus()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç backend

2. **src/components/imports/ZapisikzImportTab.tsx** (1 –∏–∑–º–µ–Ω–µ–Ω–∏–µ)
   - `uploadMutation.onSuccess` - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `pending`/`processing`

3. **src/contexts/LocaleContext.tsx** (6 –∫–ª—é—á–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–æ)
   - `zapisikz.upload_started` (ru, ky, en)
   - `zapisikz.upload_started_desc` (ru, ky, en)

## ‚úÖ –°—Ç–∞—Ç—É—Å

- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: ‚úÖ –î–∞
- **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**: ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–°–±–æ—Ä–∫–∞**: ‚úÖ –£—Å–ø–µ—à–Ω–æ (14.04s)
- **–î–∞—Ç–∞**: 1 –Ω–æ—è–±—Ä—è 2025

---

**–ê–≤—Ç–æ—Ä**: GitHub Copilot  
**–í–µ—Ä—Å–∏—è**: 1.0.0
