# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º Salary Record

## üéØ –û–±–∑–æ—Ä

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–∞—Å—Ç–µ—Ä–∞ –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/crm/masters`:
1. –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —á–µ—Ä–µ–∑ `PATCH /staff/{id}`
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è salary record** —á–µ—Ä–µ–∑ `POST /salaries?branchId={branchId}` (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞)

## ‚ú® –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–û–±–Ω–æ–≤–∏—Ç—å":

```typescript
// 1. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ (–∏–º—è, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, email –∏ —Ç.–¥.)
PATCH /staff/{id}

// 2. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –∑–∞—Ä–ø–ª–∞—Ç–∞ - —Å–æ–∑–¥–∞–µ—Ç—Å—è salary record
POST /salaries?branchId=7
{
  staff: { id, firstname, lastname, role },
  baseSalary: 10000,
  commissionRate: 0.1,
  createdBy: { ... }
}
```

## üîç –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

```
üîÑ Updating master via PATCH /staff/4
üì¶ Payload: { firstname: "–ö–∞–º–∏–ª–∞", lastname: "–£–º–∞—Ä–æ–≤–∞", ... }
üîó URL: https://scattered-ermentrude-promconsulting-23cbccde.koyeb.app/staff/4
üì° Response status: 200
‚úÖ Update response: { success: true, data: {...} }
üí∞ Creating/updating salary record for master...
‚úÖ Salary record created/updated successfully: { id: 15, ... }
```

## üîß –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### updateMasterMutation

```typescript
onSuccess: async (result) => {
  const { updatedStaff, baseSalary, commissionRate } = result;

  // 1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
  toast({ title: '–ú–∞—Å—Ç–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω' });

  // 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
  refetch();

  // 3. –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ salary record (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞)
  if ((baseSalary !== undefined || commissionRate !== undefined) && updatedStaff?.id && user) {
    try {
      const salaryResult = await salaryService.createSalaryRecord({
        staff: {
          id: updatedStaff.id,
          firstname: updatedStaff.firstname || updatedStaff.username,
          lastname: updatedStaff.lastname || '',
          role: updatedStaff.role || 'employee',
        },
        baseSalary: baseSalary || 10000,
        commissionRate: commissionRate || 0.1,
        createdBy: {
          id: user.id,
          firstname: user.firstname || user.username,
          lastname: user.lastname || '',
          role: user.role,
        },
      });

      if (salaryResult) {
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
        toast({
          title: '–ó–∞—Ä–ø–ª–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞',
          description: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞—Ä–ø–ª–∞—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã',
        });
      }
    } catch (error) {
      // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω)
      toast({
        title: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ',
        description: '–ú–∞—Å—Ç–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞—Ä–ø–ª–∞—Ç—ã',
        variant: 'destructive',
      });
    }
  }
}
```

### updateAdministratorMutation

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–∞—Å—Ç–µ—Ä—É, –Ω–æ —Å –¥—Ä—É–≥–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- `baseSalary: 15000` (–≤–º–µ—Å—Ç–æ 10000)
- `commissionRate: 0.05` (–≤–º–µ—Å—Ç–æ 0.1)
- `role: 'manager'` (–≤–º–µ—Å—Ç–æ 'employee')

## üìä –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –£—Å–ø–µ—à–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. **"–ú–∞—Å—Ç–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω"** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
2. **"–ó–∞—Ä–ø–ª–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞"** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞—Ä–ø–ª–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

### –ß–∞—Å—Ç–∏—á–Ω—ã–π —É—Å–ø–µ—Ö:
**"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ú–∞—Å—Ç–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞—Ä–ø–ª–∞—Ç—ã"**
- –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ
- –ù–æ salary record –Ω–µ —Å–æ–∑–¥–∞–Ω (–≤–æ–∑–º–æ–∂–Ω–æ, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å API)

### –û—à–∏–±–∫–∞:
**"–û—à–∏–±–∫–∞: Failed to update staff member (404)"**
- –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –æ—à–∏–±–∫–∏

## üêõ –û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–æ–∫

### "Failed to fetch"

**–ü—Ä–∏—á–∏–Ω—ã**:
1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –±—ç–∫–µ–Ω–¥–∞
2. CORS –æ—à–∏–±–∫–∞
3. –°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
4. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Bearer token

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
üîó URL: https://scattered-ermentrude-promconsulting-23cbccde.koyeb.app/staff/4
üì° Response status: (–Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å) <- –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç—å—é

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
VITE_SECONDARY_BACKEND_URL=https://scattered-ermentrude-promconsulting-23cbccde.koyeb.app

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ localStorage
localStorage.getItem('auth_token')

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
```

### "404 Not Found"

**–ü—Ä–∏—á–∏–Ω–∞**: –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å —Ç–∞–∫–∏–º ID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ ID –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

### "400 Bad Request"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ payload –≤ –∫–æ–Ω—Å–æ–ª–∏:
```
üì¶ Payload: { firstname: "", lastname: "" }
```

### "401 Unauthorized"

**–ü—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω Bearer token

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω
console.log(localStorage.getItem('auth_token'));

// –ü–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞—Ä–µ–ª
```

## üîÑ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–∞—Å—Ç–µ—Ä–∞
```
1. –û—Ç–∫—Ä—ã–≤–∞–µ–º /crm/masters
2. –ù–∞—Ö–æ–¥–∏–º –º–∞—Å—Ç–µ—Ä–∞
3. –ù–∞–∂–∏–º–∞–µ–º "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
4. –ò–∑–º–µ–Ω—è–µ–º –±–∞–∑–æ–≤—É—é –∑–∞—Ä–ø–ª–∞—Ç—É: 10000 ‚Üí 15000
5. –ù–∞–∂–∏–º–∞–µ–º "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
6. ‚úÖ –ú–∞—Å—Ç–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω
7. ‚úÖ Salary record —Å–æ–∑–¥–∞–Ω/–æ–±–Ω–æ–≤–ª–µ–Ω
8. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ /salary - –≤–∏–¥–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∑–∞—Ä–ø–ª–∞—Ç—É
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∏–º–µ–Ω–∏ (–±–µ–∑ –∑–∞—Ä–ø–ª–∞—Ç—ã)
```
1. –û—Ç–∫—Ä—ã–≤–∞–µ–º /crm/masters
2. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –º–∞—Å—Ç–µ—Ä–∞
3. –ò–∑–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –∏–º—è: "–ö–∞–º–∏–ª–∞" ‚Üí "–ö–∞–º–∏–ª–∞ –£–º–∞—Ä–æ–≤–∞"
4. –ù–∞–∂–∏–º–∞–µ–º "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
5. ‚úÖ –ú–∞—Å—Ç–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω
6. ‚ÑπÔ∏è Salary record –ù–ï —Å–æ–∑–¥–∞–µ—Ç—Å—è (—Ç.–∫. –∑–∞—Ä–ø–ª–∞—Ç–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–æ–∑–¥–∞–Ω–∏–µ salary record –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
```
1. –ú–∞—Å—Ç–µ—Ä –±—ã–ª —Å–æ–∑–¥–∞–Ω –±–µ–∑ –∑–∞—Ä–ø–ª–∞—Ç—ã
2. –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. –ó–∞–ø–æ–ª–Ω—è–µ–º –±–∞–∑–æ–≤—É—é –∑–∞—Ä–ø–ª–∞—Ç—É: 12000
4. –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∏—Å—Å–∏—é: 0.15
5. –ù–∞–∂–∏–º–∞–µ–º "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
6. ‚úÖ –ú–∞—Å—Ç–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω
7. ‚úÖ Salary record —Å–æ–∑–¥–∞–Ω
8. –ù–∞ /salary –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ vs –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
API endpoint `POST /salaries?branchId={branchId}` —Å–æ–∑–¥–∞–µ—Ç **–Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å**.

> **–í–∞–∂–Ω–æ**: –ï—Å–ª–∏ –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —É–∂–µ –µ—Å—Ç—å salary record, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ).
>
> **TODO**: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PUT /salaries/{id}` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

### –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–ú–∞—Å—Ç–µ—Ä**:
- `baseSalary: 10000` —Å–æ–º
- `commissionRate: 0.1` (10%)

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**:
- `baseSalary: 15000` —Å–æ–º
- `commissionRate: 0.05` (5%)

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å salary record –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
2. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤—Å–µ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
3. **–£–¥–æ–±—Å—Ç–≤–æ** - –≤—Å–µ –≤ –æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª–∏
5. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - –µ—Å–ª–∏ salary –Ω–µ —Å–æ–∑–¥–∞–ª—Å—è, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—Å–µ —Ä–∞–≤–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. –î–æ–±–∞–≤–∏—Ç—å `PUT /salaries/{staff_id}?branchId={branchId}` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è salary record –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
3. –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–∏—Ç—å salary record
4. –î–æ–±–∞–≤–∏—Ç—å bulk update –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ä–ø–ª–∞—Ç

---

**–ê–≤—Ç–æ—Ä**: Claude Code
**–î–∞—Ç–∞**: 2025-11-13
**–í–µ—Ä—Å–∏—è**: 2.0.0
