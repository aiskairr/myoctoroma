# Расширенный интерфейс для управления ссылками бронирования

## Обзор функциональности

Добавлена расширенная система для создания, управления и отслеживания ссылок бронирования с полной аналитикой и графиками.

## Новые компоненты

### 1. Обновленный BookingLinkCopy
**Файл:** `/src/components/BookingLinkCopy.tsx`

**Новые возможности:**
- ✅ Создание отслеживаемых ссылок через POST `/api/create-booking-params-link`
- ✅ Получение списка всех созданных ссылок через GET `/api/booking-links/:branchId`
- ✅ Отображение статистики использования ссылок
- ✅ Сворачиваемый интерфейс для экономии места
- ✅ Таблица с детальной информацией по каждой ссылке
- ✅ Копирование и QR-коды для всех ссылок

**Основные секции:**
1. **Базовая ссылка** - обычная ссылка без отслеживания
2. **Отслеживаемые ссылки** - сворачиваемая секция с:
   - Формой создания новых ссылок
   - Общей статистикой использования
   - Таблицей всех созданных ссылок
   - Числовыми показателями

### 2. BookingLinksStats - Компонент аналитики
**Файл:** `/src/components/BookingLinksStats.tsx`

**Возможности:**
- ✅ Автоматическая загрузка при заходе на Dashboard
- ✅ Сворачиваемый интерфейс
- ✅ 4 типа графиков: столбчатая, круговая, линейная, площадная
- ✅ Цифровые показатели в карточках
- ✅ Детальная таблица со всей статистикой
- ✅ Обновление каждые 30 секунд

**Отображаемые метрики:**
- Всего ссылок
- Общее количество записей
- Количество активных ссылок  
- Среднее количество записей на ссылку
- Детальная статистика по каждой ссылке

## API Интеграция

### POST /api/create-booking-params-link
```typescript
interface CreateLinkRequest {
  originalLink: string;
  content: string;
  branchId: string;
}

interface CreateLinkResponse {
  success: boolean;
  generatedLink: string;
  linkKey: string;
  message: string;
}
```

### GET /api/booking-links/:branchId
```typescript
interface BookingLink {
  id: number;
  originalLink: string;
  content: string;
  generatedLink: string;
  branchId: string;
  createdAt: string;
  usageCount: number;
  linkKey: string;
  isActive: boolean;
}

interface BookingLinksResponse {
  success: boolean;
  links: BookingLink[];
}
```

### GET /api/booking-links-stats/:branchId
```typescript
interface BookingLinkStat {
  linkKey: string;
  content: string;
  generatedLink: string;
  bookingCount: number;
  lastUsed: string | null;
}

interface BookingLinksStatsResponse {
  success: boolean;
  stats: BookingLinkStat[];
}
```

## Интеграция с Dashboard

### Расположение
Компонент `BookingLinksStats` добавлен на страницу Dashboard между статистикой мастеров и последними действиями.

### Автоматическая загрузка
- ✅ Загружается автоматически при заходе на Dashboard
- ✅ Обновляется каждые 30 секунд
- ✅ Работает только при выбранном филиале
- ✅ Показывает индикатор загрузки

### Адаптивность
- ✅ Полностью адаптивный дизайн
- ✅ Сворачиваемый интерфейс для экономии места
- ✅ Таблицы с горизонтальной прокруткой на мобильных
- ✅ Responsive сетки для статистических карточек

## Визуальные элементы

### Графики
1. **Столбчатая** - основной тип для сравнения
2. **Круговая** - для отображения долей
3. **Линейная** - для трендов
4. **Площадная** - для визуализации объемов

### Цветовая схема
- Фиолетовые оттенки для основного интерфейса
- Разноцветные индикаторы для метрик
- Gradient фоны для карточек статистики
- Консистентные цвета с остальным Dashboard

### Статистические карточки
```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│ Всего ссылок│ Записей     │ Активных    │ Среднее     │
│ [число]     │ [число]     │ [число]     │ [число]     │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

## UX/UI Особенности

### Сворачиваемый интерфейс
- Компонент сворачивается/разворачивается по клику
- Показывает общую статистику даже в свернутом виде
- Сохраняет состояние во время сессии

### Интерактивность
- Копирование ссылок одним кликом
- Генерация QR-кодов
- Открытие ссылок в новых вкладках
- Переключение типов графиков

### Обработка состояний
- ✅ Загрузка данных
- ✅ Ошибки загрузки  
- ✅ Пустое состояние (нет данных)
- ✅ Успешная загрузка данных

## Файлы изменены

1. **`/src/components/BookingLinkCopy.tsx`** - Полное обновление с новой функциональностью
2. **`/src/components/BookingLinksStats.tsx`** - Новый компонент статистики
3. **`/src/pages/Dashboard.tsx`** - Добавлен импорт и компонент статистики
4. **`/src/utils/api-url.ts`** - Утилита для правильных URL (уже была создана)

## Примеры использования

### Создание ссылки
```typescript
// Пользователь вводит: "Instagram Stories - скидка 20%"
// Система создает: https://domain.com/booking?organisationId=18&source=abc123
```

### Отслеживание
```typescript
// При записи через созданную ссылку:
// - Увеличивается счетчик использований
// - Обновляется время последнего использования  
// - В заметки записи добавляется источник
```

### Аналитика
```typescript
// Dashboard показывает:
// - 5 ссылок создано
// - 23 записи через ссылки
// - 3 активные ссылки
// - 4.6 среднее записей на ссылку
```

## Преимущества новой реализации

1. **Полная интеграция** - все API endpoints покрыты
2. **Удобный UX** - интуитивно понятный интерфейс
3. **Богатая аналитика** - графики + числовые показатели
4. **Автообновление** - актуальные данные в реальном времени
5. **Адаптивность** - работает на всех устройствах
6. **Сворачиваемость** - не загромождает Dashboard
