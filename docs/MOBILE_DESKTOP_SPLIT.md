# Разделение мобильных и десктопных компонентов филиала и календаря

## Дата: 27 ноября 2025 г.

## Обзор изменений

Выполнено разделение компонентов филиала и страницы календаря на отдельные мобильные и десктопные версии для независимой разработки и оптимизации каждой платформы.

## Изменения в компонентах

### 1. Создан мобильный компонент BranchSelectorMobile

**Файл:** `src/components/BranchSelectorMobile.tsx`

**Описание:** Новый компонент выбора филиала, оптимизированный для мобильных устройств.

**Особенности:**
- Компактные размеры элементов (h-8, text-xs)
- Оптимизированная карточка филиала с меньшими отступами
- Адаптивные модальные окна с max-h-[80vh] и overflow-y-auto
- Уменьшенные размеры аватаров (h-10 w-10 вместо h-12 w-12)
- Мобильно-оптимизированные кнопки в footer (w-full sm:w-auto)
- Градиентная кнопка выбора филиала в хедере

### 2. Откат десктопного компонента BranchSelector

**Файл:** `src/components/BranchSelector.tsx`

**Изменения:**
- Откачен к коммиту e10dba55e59ca02f8e4b02d24887dea0d0e8553f
- Ghost кнопка в sidebar (вместо градиентной)
- Стандартные размеры диалогов (sm:max-w-md)
- Стандартные отступы и размеры текста
- Классический стиль для sidebar
- Показывает только 'branch.title' (не текущий филиал)

**Подробности:** См. `docs/BRANCH_SELECTOR_ROLLBACK.md`

### 3. Обновлен MobileHeader

**Файл:** `src/components/MobileHeader.tsx`

**Изменения:**
```tsx
// Было:
import { BranchSelectorDialog } from "./BranchSelector";
<BranchSelectorDialog />

// Стало:
import { BranchSelectorMobile } from "./BranchSelectorMobile";
<BranchSelectorMobile />
```

## Изменения в страницах

### 4. Создана мобильная версия календаря

**Файл:** `src/pages/MobileCalendar/index.tsx`

**Описание:** Дублирующая страница календаря для мобильной версии.

**Особенности:**
- Копия логики из десктопного CalendarScreen (новая версия)
- Отдельные console.log с префиксом [Mobile] для отладки
- Wrapper div с классом "mobile-calendar-container" для будущих стилей
- TODO комментарий для будущих мобильных оптимизаций
- Использует тот же AdvancedScheduleComponent (временно)
- Использует `hashchange` listener (в отличие от десктопа)

**Десктопная версия** (`Calendar/index.tsx`):
- Откачена к коммиту e10dba55e59ca02f8e4b02d24887dea0d0e8553f
- Использует периодическую проверку URL (каждые 500мс)
- Без `hashchange` listener
- Два отдельных useEffect для разных задач

**Подробности:** См. `docs/CALENDAR_ROLLBACK.md`

### 5. Настроен роутинг в App.tsx

**Файл:** `src/App.tsx`

**Изменения:**

1. Добавлен импорт:
```tsx
import MobileCalendarScreen from "./pages/MobileCalendar";
```

2. Обновлен роутинг для `/crm/calendar`:
```tsx
<Route path="/crm/calendar">
  {() => {
    const isMobile = useIsMobile();
    return (
      <ProtectedLayout>
        {isMobile ? <MobileCalendarScreen /> : <CalendarScreen />}
      </ProtectedLayout>
    );
  }}
</Route>
```

**Логика:** Теперь при переходе на `/crm/calendar`:
- На мобильных устройствах рендерится `MobileCalendarScreen`
- На десктопе рендерится `CalendarScreen`

## Структура файлов

```
src/
├── components/
│   ├── BranchSelector.tsx          # Десктопная версия
│   ├── BranchSelectorMobile.tsx    # Мобильная версия (новый)
│   └── MobileHeader.tsx            # Обновлен: использует мобильную версию
├── pages/
│   ├── Calendar/
│   │   └── index.tsx               # Десктопная версия календаря
│   └── MobileCalendar/
│       └── index.tsx               # Мобильная версия календаря (новый)
└── App.tsx                         # Обновлен: условный роутинг
```

## Дальнейшие шаги

### Для мобильного календаря:
1. Оптимизировать компоненты расписания для touch-интерфейса
2. Добавить свайп-жесты для навигации по датам
3. Уменьшить размеры элементов для мобильного экрана
4. Оптимизировать модальные окна и диалоги
5. Добавить pull-to-refresh
6. Адаптировать шрифты и отступы

### Для мобильного BranchSelector:
1. Можно добавить bottom sheet вместо dialog
2. Оптимизировать для одной руки
3. Добавить haptic feedback

### Для десктопного календаря:
1. Можно увеличить информативность карточек
2. Добавить drag-and-drop для записей
3. Расширить видимые данные на большом экране
4. Добавить клавиатурные shortcut'ы

## Преимущества разделения

1. **Независимая разработка**: Изменения в мобильной версии не влияют на десктоп
2. **Оптимизация**: Каждая версия оптимизирована под свою платформу
3. **Поддержка**: Легче поддерживать и дебажить отдельные версии
4. **Performance**: Можно загружать только нужный код для каждой платформы
5. **UX**: Возможность создать уникальный UX для каждой платформы

## Тестирование

Для тестирования изменений:
1. Откройте приложение на десктопе → должен быть десктопный календарь и филиал
2. Откройте через DevTools с мобильным viewport → должен быть мобильный календарь и филиал
3. Проверьте переключение филиала на обеих платформах
4. Проверьте навигацию по датам в календаре
5. Проверьте редактирование филиала

## Примечания

- Обе версии используют одинаковые контексты (BranchContext, AuthContext)
- Обе версии используют одинаковые хуки (useIsMobile, useBranch)
- Backend API остается неизменным
- Логика работы идентична, различается только UI/UX

## Версии файлов

- **BranchSelector.tsx**: Десктопная версия (откачена назад)
- **BranchSelectorMobile.tsx**: Мобильная версия (создана)
- **MobileHeader.tsx**: Обновлен для использования мобильной версии
- **Calendar/index.tsx**: Десктопная версия (без изменений)
- **MobileCalendar/index.tsx**: Мобильная версия (создана)
- **App.tsx**: Добавлен условный роутинг

---

**Статус:** ✅ Все задачи выполнены
**Ошибки:** Нет
**Готово к тестированию:** Да
