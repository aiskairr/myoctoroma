# Task Parser - Реализация завершена ✅

## Что было создано

### 1. Основной сервис парсера
**Файл:** `src/services/task-parser.ts`
- ✅ Singleton сервис для управления парсером
- ✅ Отправка запросов каждую минуту
- ✅ Подписки на обновления данных
- ✅ Гибкая настройка параметров

### 2. React хуки
**Файл:** `src/hooks/use-task-parser.ts`
- ✅ `useTaskParser` - основной хук с ручным управлением
- ✅ `useTaskParserForDate` - парсинг для конкретной даты
- ✅ `useAutoTaskParser` - автоматический парсинг с колбэками

### 3. UI компонент управления
**Файл:** `src/components/TaskParserControlPanel.tsx`
- ✅ Панель управления парсером
- ✅ Визуализация статуса и данных
- ✅ Кнопки запуска/остановки
- ✅ Выбор даты для парсинга
- ✅ Предварительный просмотр данных

### 4. Интеграция с календарем
**Файл:** `src/pages/DailyCalendar.tsx`
- ✅ Добавлена панель парсера в календарь
- ✅ Автоматические уведомления о новых данных
- ✅ Связь с выбранной датой календаря

## Функциональность

### ⚡ API Endpoint
```
https://partial-elfrida-promconsulting-9e3c84f1.koyeb.app/api/tasks
```

### 📋 Параметры запроса
- `branchId=1`
- `scheduledAfter=2025-10-02T18:00:00.000Z`
- `scheduledBefore=2025-10-03T17:59:59.999Z`
- `sortBy=scheduleDate`
- `sortOrder=asc`
- `userRole=superadmin`

### ⏰ Интервал
- **20 секунд** (20000 мс)
- Автоматический перезапуск при изменении даты
- Graceful обработка ошибок

## Как использовать

### 1. Автоматический запуск в календаре
Откройте страницу "Календарь записей" - панель парсера уже интегрирована сверху.

### 2. Программное управление
```typescript
import { taskParserService } from '@/services/task-parser';

// Запуск
taskParserService.start();

// Подписка на данные
const unsubscribe = taskParserService.subscribe((data) => {
  console.log('Получено записей:', data.count);
});

// Остановка
taskParserService.stop();
```

### 3. React хуки
```typescript
import { useTaskParser } from '@/hooks/use-task-parser';

const MyComponent = () => {
  const parser = useTaskParser({
    autoStart: true,
    onDataReceived: (data) => {
      console.log('Новые данные:', data);
    }
  });

  return (
    <div>
      <p>Записей: {parser.tasksCount}</p>
      <button onClick={() => parser.start()}>Запустить</button>
      <button onClick={() => parser.stop()}>Остановить</button>
    </div>
  );
};
```

## Возможности панели управления

### 📊 Информационные блоки
- Статус парсера (Запущен/Остановлен)
- Количество найденных записей
- Количество активных подписчиков
- Статус API (OK/Ошибка)

### 🎛️ Управление
- **Запустить парсер** - начать автоматический опрос каждую минуту
- **Остановить** - прекратить опрос
- **Запросить сейчас** - единоразовый запрос данных
- **Перезапустить** - остановить и запустить заново

### 📅 Настройки
- Выбор даты для парсинга
- Автоматическое формирование диапазона времени
- Отображение текущих параметров API

### 🔍 Мониторинг
- Время последнего обновления
- Предварительный просмотр полученных данных
- Детальная информация об API endpoint
- Отображение ошибок

## Логирование

Парсер выводит подробные логи в консоль браузера:

```
[TaskParser] Starting task parser...
[TaskParser] Fetching tasks from: https://partial-elfrida-promconsulting-9e3c84f1.koyeb.app/api/tasks?...
[TaskParser] Successfully fetched 5 tasks at 2025-10-03T12:00:00.000Z
[useTaskParser] Received data: {...}
[DailyCalendar] Received parser data: {...}
```

## Архитектура

```
┌─────────────────────────────────────┐
│ TaskParserControlPanel (UI)         │
│ - Управление парсером               │
│ - Отображение статуса               │
│ - Выбор даты                        │
└─────────────────┬───────────────────┘
                  │
┌─────────────────▼───────────────────┐
│ useTaskParser (React Hook)          │
│ - Подписка на данные                │
│ - Управление состоянием             │
│ - Обработка ошибок                  │
└─────────────────┬───────────────────┘
                  │
┌─────────────────▼───────────────────┐
│ taskParserService (Core Service)    │
│ - HTTP запросы к API                │
│ - Интервальный опрос (1 минута)     │
│ - Singleton pattern                 │
│ - Управление подписчиками           │
└─────────────────┬───────────────────┘
                  │
┌─────────────────▼───────────────────┐
│ External API                        │
│ https://puny-noemi-promconsulting   │
│ -453531f5.koyeb.app/api/tasks       │
└─────────────────────────────────────┘
```

## Технические детали

### 🔧 TypeScript интерфейсы
- `ParsedTask` - структура задачи из API
- `TaskParserResponse` - ответ парсера
- `UseTaskParserOptions` - опции хука

### 🛡️ Обработка ошибок
- Автоматический retry при сбоях сети
- Логирование всех ошибок
- Уведомления пользователя через toast

### 📱 Responsive дизайн
- Адаптивная панель управления
- Grid layout для информационных блоков
- Складываемые секции с деталями

### ⚡ Производительность
- Singleton для предотвращения дублирования
- Автоматическая отписка при размонтировании
- Оптимизированные re-renders

## Файлы проекта

```
src/
├── services/
│   └── task-parser.ts              # Основной сервис парсера
├── hooks/
│   └── use-task-parser.ts          # React хуки
├── components/
│   └── TaskParserControlPanel.tsx  # UI панель управления
├── pages/
│   └── DailyCalendar.tsx          # Интеграция с календарем
├── examples/
│   └── task-parser-examples.tsx   # Примеры использования
└── TASK_PARSER_README.md          # Подробная документация
```

## Статус: ✅ Готово к использованию

Парсер полностью интегрирован в проект и готов к работе. Откройте страницу календаря для начала использования.

### Следующие шаги:
1. Откройте страницу "Календарь записей"
2. Найдите панель "Task Parser API" в верхней части
3. Нажмите "Запустить парсер"
4. Наблюдайте за автоматическими обновлениями каждую минуту

### Поддержка:
- Подробная документация в `TASK_PARSER_README.md`
- Примеры использования в `examples/task-parser-examples.tsx`
- Логирование в консоли браузера для отладки
